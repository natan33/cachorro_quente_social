{% extends 'layouts/base.html' %}

{% block title %}Dashboard - Vendas Hot-Dog{% endblock %}

{% block content %}
<div class="row align-items-center mb-4">
    <div class="col-md-6">
        <h2 class="mb-0">Dashboard de Vendas</h2>
    </div>
    <div class="col-md-6 text-end">
        <button class="btn btn-success rounded-circle shadow-lg" data-bs-toggle="modal"
            data-bs-target="#registerSaleModal" title="Nova Venda"
            style="width: 50px; height: 50px; font-size: 24px; line-height: 1; padding: 0;">
            +
        </button>
    </div>
</div>


<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3 shadow">
            <div class="card-header">Vendas do Dia</div>
            <div class="card-body">
                <h4 class="card-title" id="dailySalesCard">Carregando...</h4>
                <p class="card-text">Total de vendas hoje.</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3 shadow">
            <div class="card-header">Total de Vendas (Geral)</div>
            <div class="card-body">
                <h4 class="card-title" id="totalSalesCard">Carregando...</h4>
                <p class="card-text">Total de vendas acumuladas.</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3 shadow">
            <div class="card-header">Transações Hoje</div>
            <div class="card-body">
                <h4 class="card-title" id="dailyTransactionsCard">Carregando...</h4>
                <p class="card-text">Número de vendas realizadas hoje.</p>
            </div>
        </div>
    </div>
</div>

<div class="card shadow mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">Filtros de Vendas</h5>
    </div>
    <div class="card-body">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
                <label for="startDate" class="form-label">Data Início</label>
                <input type="date" class="form-control" id="startDate">
            </div>
            <div class="col-md-3">
                <label for="endDate" class="form-label">Data Fim</label>
                <input type="date" class="form-control" id="endDate">
            </div>
            <div class="col-md-3">
                <label for="productFilter" class="form-label">Produto</label>
                <input type="text" class="form-control" id="productFilter" placeholder="Nome do Produto">
            </div>
            <div class="col-md-3">
                <label for="userFilter" class="form-label">Vendedor</label>
                <input type="text" class="form-control" id="userFilter" placeholder="Nome do Vendedor">
            </div>

            <div class="col-md-3">


            </div>

            <div class="col-md-12 text-end">
                <button class="btn btn-secondary me-2" id="clearFilters">Limpar Filtros</button>
                <button class="btn btn-primary" id="applyFilters">Aplicar Filtros</button>
            </div>
        </div>
    </div>
</div>

<div class="card shadow mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">Registros de Vendas</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="salesTable" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>ID da Venda</th>
                        <th>Data da Venda</th>
                        <th>Valor Total</th>
                        <th>Método Pagamento</th>
                        <th>Vendedor</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="saleDetailsModal" tabindex="-1" aria-labelledby="saleDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="saleDetailsModalLabel">Detalhes da Venda #<span id="modalSaleId"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>Vendedor:</strong> <span id="modalSeller"></span></p>
                <p><strong>Data da Venda:</strong> <span id="modalSaleDate"></span></p>
                <p><strong>Valor Total:</strong> <span id="modalTotalAmount"></span></p>
                <p><strong>Método de Pagamento:</strong> <span id="modalPaymentMethod"></span></p>
                <p><strong>Observações:</strong> <span id="modalNotes"></span></p>

                <h6>Itens da Venda:</h6>
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>Quantidade</th>
                            <th>Preço Unitário</th>
                            <th>Total Item</th>
                        </tr>
                    </thead>
                    <tbody id="modalSaleItems">
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal de Registro de Venda -->
<div class="modal fade" id="registerSaleModal" tabindex="-1" aria-labelledby="registerSaleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="registerSaleModalLabel">Registrar Nova Venda</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <form id="saleForm">
                    <!-- Produto fixo -->
                    <div class="mb-3">
                        <label for="productName" class="form-label">Produto</label>
                        <input type="text" class="form-control" id="productName" value="Cachorro Quente" readonly>
                    </div>

                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantidade</label>
                        <input type="number" class="form-control" id="quantity" value="1" min="1" required>
                    </div>

                    <div class="mb-3">
                        <label for="paymentMethod" class="form-label">Método de Pagamento</label>
                        <select class="form-select" id="paymentMethod" name="payment_method" required>
                            <option value="">Selecione...</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Cartão Débito">Cartão Débito</option>
                            <option value="Cartão Crédito">Cartão Crédito</option>
                            <option value="PIX">PIX</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Pagamento efetuado?</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="payment_status" id="paymentPaid" value="paid">
                            <label class="form-check-label" for="paymentPaid">Sim</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="payment_status" id="paymentNotPaid" value="not_paid" checked>
                            <label class="form-check-label" for="paymentNotPaid">Não</label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="notes" class="form-label">Observações (Opcional)</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6 offset-md-6 text-end">
                            <h4>Total da Venda: <span id="totalAmount">R$ 5.00</span></h4>
                        </div>
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-success btn-lg">Finalizar Venda</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>




{% endblock %}

{% block scripts %}
<script src="{{ vite_asset('dashboard.js')}}"></script>
<script src="{{ vite_asset('registro_venda.js')}}"></script>
{% endblock %}