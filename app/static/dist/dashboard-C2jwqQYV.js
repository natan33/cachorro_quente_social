$(document).ready(function(){var o;function r(){$.ajax({url:"/api/dashboard_cards_data",method:"GET",success:function(t){$("#dailySalesCard").text(t.daily_sales),$("#totalSalesCard").text(t.total_sales),$("#dailyTransactionsCard").text(t.daily_transactions);var a="";t.top_products_today.length>0?(a+="<h6>Top 3 Produtos Vendidos Hoje:</h6><ul>",$.each(t.top_products_today,function(e,l){a+="<li>"+l.name+" ("+l.quantity+" unidades)</li>"}),a+="</ul>"):a+="<p>Nenhum produto vendido hoje.</p>",console.log("Top Produtos Hoje:",a)},error:function(t,a,e){console.error("Erro ao carregar dados dos cards:",e)}})}function s(){$.fn.DataTable.isDataTable("#salesTable")&&$("#salesTable").DataTable().destroy(),o=$("#salesTable").DataTable({processing:!0,serverSide:!0,ajax:{url:"/api/sales",type:"GET",data:function(t){t.start_date=$("#startDate").val(),t.end_date=$("#endDate").val(),t.product_filter=$("#productFilter").val(),t.user_filter=$("#userFilter").val()}},columns:[{data:0},{data:1},{data:2},{data:3},{data:4},{data:5,orderable:!1}],language:{url:"https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json"},order:[[1,"desc"]]})}r(),s(),$("#applyFilters").on("click",function(){o.ajax.reload(),r()}),$("#clearFilters").on("click",function(){$("#startDate").val(""),$("#endDate").val(""),$("#productFilter").val(""),$("#userFilter").val(""),o.ajax.reload(),r()}),$("#salesTable tbody").on("click",".view-details",function(){var t=$(this).data("id");$.ajax({url:`/api/sale_details/${t}`,method:"GET",success:function(a){$("#modalSaleId").text(a.id),$("#modalSeller").text(a.seller),$("#modalSaleDate").text(a.sale_date),$("#modalTotalAmount").text(a.total_amount),$("#modalPaymentMethod").text(a.payment_method),$("#modalNotes").text(a.notes);var e="";$.each(a.items,function(i,d){e+=`
                            <tr>
                                <td>${d.product_name}</td>
                                <td>${d.quantity}</td>
                                <td>${d.unit_price}</td>
                                <td>${d.item_total}</td>
                            </tr>
                        `}),$("#modalSaleItems").html(e);var l=new bootstrap.Modal(document.getElementById("saleDetailsModal"));l.show()},error:function(a,e,l){alert("Erro ao carregar detalhes da venda: "+l)}})})});
